
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>DreamWeaver - å¤¢å¢ƒè§£æ</title>
  
  <!-- 1. Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. React æ ¸å¿ƒ (ä½¿ç”¨ç©©å®šçš„ 18 ç‰ˆæœ¬ UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- 3. Recharts åœ–è¡¨åº« (å¿…é ˆåœ¨ React ä¹‹å¾Œè¼‰å…¥) -->
  <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
  
  <!-- 4. D3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  
  <!-- 5. Babel (ç€è¦½å™¨å³æ™‚ç·¨è­¯ JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      background-color: #0f172a; /* Slate 950 */
      color: #f8fafc; /* Slate 50 */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    
    /* è¼‰å…¥å‹•ç•« */
    .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "uuid": "https://aistudiocdn.com/uuid@^13.0.0",
    "d3": "https://aistudiocdn.com/d3@^7.9.0",
    "recharts": "https://aistudiocdn.com/recharts@^3.5.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <!-- ä¸»ç¨‹å¼ -->
  <script type="text/babel">
    // --- å®‰å…¨ç²å–å…¨åŸŸè®Šæ•¸ ---
    const React = window.React;
    const ReactDOM = window.ReactDOM;
    const { useState, useEffect, useRef, useMemo } = React;
    
    // Recharts å…ƒä»¶
    const { PieChart, Pie, Cell, ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, Legend } = window.Recharts || {};

    // --- åœ–ç¤º (SVG) ---
    // é¿å…ä½¿ç”¨å¤–éƒ¨åº«ï¼Œç›´æ¥å…§åµŒ SVG ä»¥ç¢ºä¿é¡¯ç¤º
    const Icon = ({ d, className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        {d}
      </svg>
    );

    const Icons = {
      Key: (p) => <Icon {...p} d={<><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" /></>} />,
      Plus: (p) => <Icon {...p} d={<><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>} />,
      List: (p) => <Icon {...p} d={<><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></>} />,
      Activity: (p) => <Icon {...p} d={<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>} />,
      Calendar: (p) => <Icon {...p} d={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></>} />,
      Users: (p) => <Icon {...p} d={<><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></>} />,
      MapPin: (p) => <Icon {...p} d={<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></>} />,
      Heart: (p) => <Icon {...p} d={<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>} />,
      Sparkles: (p) => <Icon {...p} d={<><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></>} />,
      Refresh: (p) => <Icon {...p} d={<><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></>} />,
      Loader: (p) => <Icon {...p} className={`${p.className} animate-spin`} d={<path d="M21 12a9 9 0 1 1-6.21-14.99"></path>} />,
      Help: (p) => <Icon {...p} d={<circle cx="12" cy="12" r="10"></circle>} />
    };

    // --- å·¥å…·å‡½å¼ ---
    const uuidv4 = () => {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    };

    // --- Gemini API (ä½¿ç”¨ Fetch) ---
    const analyzeDreamText = async (apiKey, dreamText, context, reentryRecord) => {
      const modelName = "gemini-2.0-flash"; 
      const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

      const systemInstruction = `
        You are an expert dream analyst and Jungian psychologist. 
        Task: Break down the dream into "fragments".
        
        Analyze each fragment for:
        1. Characters
        2. Locations
        3. Emotions
        4. Colors (Infer if not explicit: Fear=Black/Red, Sad=Blue, etc.)
        5. Actions
        6. Energy Score (0-100)
        7. Interpretation (Psychoanalytic)

        IMPORTANT: Output MUST be in Traditional Chinese (ç¹é«”ä¸­æ–‡).
        Return ONLY raw JSON object.
      `;

      const prompt = `
        Context: ${context || "None"}
        Re-entry Record: ${reentryRecord || "None"}
        Dream: ${dreamText}
      `;

      const payload = {
        contents: [{ parts: [{ text: prompt }] }],
        systemInstruction: { parts: [{ text: systemInstruction }] },
        generationConfig: {
          responseMimeType: "application/json",
          responseSchema: {
            type: "OBJECT",
            properties: {
              fragments: {
                type: "ARRAY",
                items: {
                  type: "OBJECT",
                  properties: {
                    text: { type: "STRING" },
                    characters: { type: "ARRAY", items: { type: "STRING" } },
                    locations: { type: "ARRAY", items: { type: "STRING" } },
                    emotions: { type: "ARRAY", items: { type: "STRING" } },
                    colors: { type: "ARRAY", items: { type: "STRING" } },
                    actions: { type: "ARRAY", items: { type: "STRING" } },
                    energy_score: { type: "INTEGER" },
                    interpretation: { type: "STRING" },
                  },
                  required: ["text", "characters", "locations", "emotions", "colors", "actions", "energy_score", "interpretation"]
                }
              }
            }
          }
        }
      };

      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (!response.ok) throw new Error("API Request Failed");
      const data = await response.json();
      const jsonText = data.candidates?.[0]?.content?.parts?.[0]?.text;
      if (!jsonText) throw new Error("No text returned");
      
      const parsed = JSON.parse(jsonText);
      return parsed.fragments.map(f => ({ ...f, id: uuidv4() }));
    };

    // --- å­çµ„ä»¶ ---

    const TagSelector = ({ title, icon, options, selected, onChange, placeholder, colorClass }) => {
      const [customInput, setCustomInput] = useState('');

      const toggleTag = (tag) => {
        if (selected.includes(tag)) onChange(selected.filter(t => t !== tag));
        else onChange([...selected, tag]);
      };

      const handleAddCustom = () => {
        if (customInput.trim() && !selected.includes(customInput.trim())) {
          onChange([...selected, customInput.trim()]);
          setCustomInput('');
        }
      };

      const displayOptions = Array.from(new Set([...options, ...selected]));

      return (
        <div className="mb-6">
          <label className="flex items-center text-sm font-medium text-slate-300 mb-3">
            {icon}
            <span className="ml-2">{title}</span>
          </label>
          <div className="flex flex-wrap gap-2 mb-3">
            {displayOptions.map(tag => (
              <button
                key={tag}
                onClick={() => toggleTag(tag)}
                className={`px-3 py-1.5 rounded-full text-xs transition-all border ${
                  selected.includes(tag)
                    ? `${colorClass} text-white border-transparent shadow-md` 
                    : 'bg-slate-900 text-slate-400 border-slate-700 hover:border-slate-500'
                }`}
              >
                {tag}
              </button>
            ))}
          </div>
          <div className="flex gap-2">
            <input 
              type="text" 
              value={customInput}
              onChange={(e) => setCustomInput(e.target.value)}
              onKeyDown={(e) => e.key === 'Enter' && handleAddCustom()}
              className="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 focus:outline-none focus:border-indigo-500"
              placeholder={placeholder}
            />
            <button onClick={handleAddCustom} className="bg-slate-700 text-slate-200 px-3 py-2 rounded-lg text-sm">
              <Icons.Plus size={16} />
            </button>
          </div>
        </div>
      );
    };

    const NetworkGraph = ({ dreams }) => {
      const svgRef = useRef(null);
      useEffect(() => {
        if (!svgRef.current || dreams.length === 0 || !window.d3) return;
        
        const nodes = [];
        const links = [];
        const nodeSet = new Set();

        dreams.forEach(dream => {
          dream.fragments.forEach(frag => {
            if (!nodeSet.has(frag.id)) {
              nodes.push({ id: frag.id, group: 'fragment', name: frag.text.substring(0, 8) + '...', val: 10 });
              nodeSet.add(frag.id);
            }
            const addEntity = (entity, group) => {
              const eid = `${group}-${entity}`;
              if (!nodeSet.has(eid)) {
                nodes.push({ id: eid, group, name: entity, val: 5 });
                nodeSet.add(eid);
              }
              links.push({ source: frag.id, target: eid });
            };
            frag.emotions.forEach(e => addEntity(e, 'emotion'));
            frag.colors.forEach(c => addEntity(c, 'color'));
          });
        });

        const svg = d3.select(svgRef.current);
        svg.selectAll("*").remove();
        const width = svgRef.current.parentElement.clientWidth;
        const height = 400;

        const simulation = d3.forceSimulation(nodes)
          .force("link", d3.forceLink(links).id(d => d.id).distance(60))
          .force("charge", d3.forceManyBody().strength(-150))
          .force("center", d3.forceCenter(width / 2, height / 2));

        const link = svg.append("g").selectAll("line").data(links).join("line").attr("stroke", "#475569").attr("stroke-width", 1);
        const node = svg.append("g").selectAll("circle").data(nodes).join("circle")
          .attr("r", d => d.group === 'fragment' ? 6 : 4)
          .attr("fill", d => d.group === 'fragment' ? '#818cf8' : d.group === 'emotion' ? '#f472b6' : '#fbbf24')
          .call(d3.drag().on("start", (event, d) => {
             if (!event.active) simulation.alphaTarget(0.3).restart();
             d.fx = d.x; d.fy = d.y;
          }).on("drag", (event, d) => {
             d.fx = event.x; d.fy = event.y;
          }).on("end", (event, d) => {
             if (!event.active) simulation.alphaTarget(0);
             d.fx = null; d.fy = null;
          }));
          
        const text = svg.append("g").selectAll("text").data(nodes).join("text")
          .text(d => d.name).attr("font-size", 8).attr("fill", "#ccc").attr("dx", 8).attr("dy", 3);

        simulation.on("tick", () => {
          link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
          node.attr("cx", d => d.x).attr("cy", d => d.y);
          text.attr("x", d => d.x).attr("y", d => d.y);
        });

      }, [dreams]);
      
      return <div className="w-full h-[400px] bg-slate-900 rounded-xl overflow-hidden border border-slate-700 relative"><svg ref={svgRef} className="w-full h-full"></svg></div>;
    };

    // --- ä¸»ç¨‹å¼ App ---
    const App = () => {
      const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');
      const [view, setView] = useState('home');
      const [dreams, setDreams] = useState([]);
      const [isAnalyzing, setIsAnalyzing] = useState(false);

      // è¡¨å–®
      const [inputDate, setInputDate] = useState(new Date().toISOString().split('T')[0]);
      const [inputDream, setInputDream] = useState('');
      const [inputContext, setInputContext] = useState('');
      const [inputReentry, setInputReentry] = useState('');
      const [selChar, setSelChar] = useState([]);
      const [selLoc, setSelLoc] = useState([]);
      const [selEmo, setSelEmo] = useState([]);

      const DEFAULT_CHAR = ["å®¶äºº", "æœ‹å‹", "ä¼´ä¾¶", "é™Œç”Ÿäºº", "ç‹—", "è²“", "é€è€…"];
      const DEFAULT_LOC = ["å®¶è£¡", "å­¸æ ¡", "è¾¦å…¬å®¤", "è€å®¶", "æ£®æ—", "æµ·é‚Š", "äº¤é€šå·¥å…·"];
      const DEFAULT_EMO = ["å®³æ€•", "å¿«æ¨‚", "å›°æƒ‘", "æ‚²å‚·", "ç”Ÿæ°£", "å¹³éœ"];

      useEffect(() => {
        const saved = localStorage.getItem('dreams_db');
        if (saved) setDreams(JSON.parse(saved));
      }, []);

      useEffect(() => {
        if (dreams.length) localStorage.setItem('dreams_db', JSON.stringify(dreams));
      }, [dreams]);

      const saveKey = (k) => { setApiKey(k); localStorage.setItem('gemini_api_key', k); };

      const handleAnalyze = async () => {
        if (!inputDream && !selChar.length && !selLoc.length && !selEmo.length) return alert("è«‹è¼¸å…¥å…§å®¹");
        
        setIsAnalyzing(true);
        try {
          let text = inputDream;
          let tags = [];
          if(selChar.length) tags.push(`äººç‰©: ${selChar.join(',')}`);
          if(selLoc.length) tags.push(`å ´æ™¯: ${selLoc.join(',')}`);
          if(selEmo.length) tags.push(`æƒ…ç·’: ${selEmo.join(',')}`);
          if(tags.length) text += `\n[æ¨™ç±¤]: ${tags.join(' ')}`;

          const frags = await analyzeDreamText(apiKey, text, inputContext, inputReentry);
          
          const newDream = {
            id: uuidv4(),
            date: inputDate,
            rawText: text,
            context: inputContext,
            reentryRecord: inputReentry,
            fragments: frags
          };

          setDreams(prev => [newDream, ...prev]);
          setInputDream(''); setInputContext(''); setInputReentry('');
          setSelChar([]); setSelLoc([]); setSelEmo([]);
          setView('journal');
        } catch(e) {
          alert("éŒ¯èª¤: " + e.message);
        } finally {
          setIsAnalyzing(false);
        }
      };

      if (!apiKey) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-slate-950 p-4">
            <div className="bg-slate-900 p-8 rounded-2xl border border-slate-800 max-w-md w-full text-center">
              <h1 className="text-2xl font-bold mb-4">DreamWeaver</h1>
              <p className="text-slate-400 text-sm mb-4">è«‹è¼¸å…¥ Gemini API Key ä»¥å•Ÿå‹•</p>
              <input type="password" placeholder="API Key" className="w-full bg-slate-950 border border-slate-700 p-3 rounded text-white mb-4" onBlur={e => saveKey(e.target.value)} />
              <button className="w-full bg-indigo-600 text-white p-3 rounded font-bold">ç¢ºèª</button>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen pb-20 fade-in">
          {/* Header */}
          <header className="bg-slate-900/80 backdrop-blur border-b border-slate-800 p-4 sticky top-0 z-50 flex justify-between items-center">
            <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-300 to-purple-300">DreamWeaver</h1>
            <button onClick={() => saveKey('')} className="text-xs text-slate-500">é‡è¨­ Key</button>
          </header>

          <main className="p-4 max-w-2xl mx-auto">
            {view === 'home' && (
              <div className="space-y-6">
                <div className="bg-slate-800 p-5 rounded-2xl border border-slate-700 shadow-xl space-y-4">
                  <div>
                    <label className="text-sm text-slate-400 block mb-2">æ—¥æœŸ</label>
                    <input type="date" value={inputDate} onChange={e=>setInputDate(e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded p-3 text-white"/>
                  </div>
                  <div>
                    <label className="text-sm text-slate-400 block mb-2">å¤¢å¢ƒå…§å®¹</label>
                    <textarea value={inputDream} onChange={e=>setInputDream(e.target.value)} className="w-full h-32 bg-slate-900 border border-slate-700 rounded p-3 text-white" placeholder="æˆ‘å¤¢è¦‹..."></textarea>
                  </div>
                  
                  <TagSelector title="äººç‰©" icon={<Icons.Users className="text-emerald-400 w-4 h-4"/>} options={DEFAULT_CHAR} selected={selChar} onChange={setSelChar} placeholder="æ–°å¢..." colorClass="bg-emerald-600" />
                  <TagSelector title="å ´æ™¯" icon={<Icons.MapPin className="text-amber-400 w-4 h-4"/>} options={DEFAULT_LOC} selected={selLoc} onChange={setSelLoc} placeholder="æ–°å¢..." colorClass="bg-amber-600" />
                  <TagSelector title="æƒ…ç·’" icon={<Icons.Heart className="text-pink-400 w-4 h-4"/>} options={DEFAULT_EMO} selected={selEmo} onChange={setSelEmo} placeholder="æ–°å¢..." colorClass="bg-pink-600" />

                  <div>
                    <label className="text-sm text-slate-400 block mb-2">è¿‘æœŸç…©æƒ±/äº‹ä»¶</label>
                    <input type="text" value={inputContext} onChange={e=>setInputContext(e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded p-3 text-white"/>
                  </div>

                  <div className="bg-indigo-950/30 p-4 rounded border border-indigo-500/20">
                    <label className="text-sm text-indigo-300 block mb-2 flex items-center"><Icons.Refresh className="w-4 h-4 mr-2"/> å›åˆ°å¤¢è£¡å°è©± (é€²éš)</label>
                    <textarea value={inputReentry} onChange={e=>setInputReentry(e.target.value)} className="w-full h-20 bg-slate-900 border border-slate-700 rounded p-3 text-white" placeholder="æˆ‘å•å¤¢ä¸­çš„ä»–..."></textarea>
                  </div>

                  <button onClick={handleAnalyze} disabled={isAnalyzing} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-xl flex justify-center items-center shadow-lg shadow-indigo-500/30 disabled:opacity-50">
                    {isAnalyzing ? <><Icons.Loader className="mr-2"/> è§£æä¸­...</> : <><Icons.Sparkles className="mr-2"/> é–‹å§‹è§£æ</>}
                  </button>
                </div>
              </div>
            )}

            {view === 'journal' && (
              <div className="space-y-6">
                <h2 className="text-xl font-bold flex items-center"><Icons.List className="mr-2"/> å¤¢å¢ƒç¢ç‰‡</h2>
                {dreams.length === 0 ? <p className="text-slate-500 text-center">ç„¡ç´€éŒ„</p> : dreams.map(d => (
                  <div key={d.id} className="bg-slate-800 rounded-xl overflow-hidden border border-slate-700">
                    <div className="bg-slate-900/50 p-3 flex justify-between text-sm text-slate-400 border-b border-slate-700">
                      <span>{d.date}</span>
                      {d.context && <span className="truncate max-w-[150px]">{d.context}</span>}
                    </div>
                    {d.reentryRecord && (
                      <div className="p-3 bg-indigo-900/20 text-xs text-indigo-200 border-b border-indigo-900/30">
                        <strong>å›åˆ°å¤¢è£¡:</strong> {d.reentryRecord}
                      </div>
                    )}
                    <div className="p-4 space-y-3">
                      {d.fragments.map(f => (
                        <div key={f.id} className="bg-slate-700/30 p-3 rounded border border-slate-600/50">
                          <div className="flex justify-between mb-1">
                            <span className="text-sm font-bold text-white">{f.text}</span>
                            <span className="text-xs bg-slate-700 px-1 rounded text-slate-300">E:{f.energy_score}</span>
                          </div>
                          <p className="text-xs text-indigo-300 mt-2">ğŸ”® {f.interpretation}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            )}

            {view === 'dashboard' && (
               <div className="space-y-8">
                 <h2 className="text-xl font-bold">æ•¸æ“šæ´å¯Ÿ</h2>
                 <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                   <h3 className="mb-4 text-sm text-slate-400">æƒ…ç·’åˆ†ä½ˆ (Top 5)</h3>
                   <div className="h-48">
                     <ResponsiveContainer width="100%" height="100%">
                       <BarChart data={(() => {
                          const counts = {};
                          dreams.forEach(d => d.fragments.forEach(f => f.emotions.forEach(e => counts[e] = (counts[e]||0)+1)));
                          return Object.entries(counts).map(([k,v]) => ({name:k, value:v})).sort((a,b)=>b.value-a.value).slice(0,5);
                       })()} layout="vertical">
                         <XAxis type="number" hide />
                         <YAxis dataKey="name" type="category" width={50} tick={{fill:'#cbd5e1', fontSize:12}} />
                         <Bar dataKey="value" fill="#818cf8" radius={[0,4,4,0]} />
                       </BarChart>
                     </ResponsiveContainer>
                   </div>
                 </div>
                 
                 <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                   <h3 className="mb-4 text-sm text-slate-400">é—œè¯æ˜Ÿåœ–</h3>
                   <NetworkGraph dreams={dreams} />
                 </div>
               </div>
            )}
          </main>

          <nav className="fixed bottom-0 w-full bg-slate-900 border-t border-slate-800 flex justify-around p-2 pb-safe z-50">
            <button onClick={()=>setView('home')} className={`p-2 flex flex-col items-center ${view==='home'?'text-indigo-400':'text-slate-500'}`}><Icons.Plus size={20}/><span className="text-[10px]">è¨˜éŒ„</span></button>
            <button onClick={()=>setView('journal')} className={`p-2 flex flex-col items-center ${view==='journal'?'text-indigo-400':'text-slate-500'}`}><Icons.List size={20}/><span className="text-[10px]">åˆ—è¡¨</span></button>
            <button onClick={()=>setView('dashboard')} className={`p-2 flex flex-col items-center ${view==='dashboard'?'text-indigo-400':'text-slate-500'}`}><Icons.Activity size={20}/><span className="text-[10px]">æ´å¯Ÿ</span></button>
          </nav>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
    